<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.project.itda.timeline.dao.ITimeLineRepository">

	<select id="getContent"
		resultType="com.project.itda.timeline.model.TimeLineModel">
		select * from TIMELINE
		where FAMILYSEQ = #{familySeq}
		and TYPE = 'Family'
		order by createDate DESC
	</select>
	
	<insert id="insert"  
		parameterType="com.project.itda.timeline.model.TimeLineModel">
			INSERT INTO TIMELINE (postSeq, userId, createDate, content, familySeq, filename, filepath)
               VALUES (postSeq.NEXTVAL, #{userId}, SYSDATE, #{content}, #{familySeq}, #{filename}, #{filepath})
	</insert>
	
	<update id="update"
		parameterType="com.project.itda.timeline.model.TimeLineModel">
			update TIMELINE set 
				content = #{content},
				filepath = #{filepath},
				filename = #{filename},
				
				where postSeq = #{postSeq}
	</update>
	
	<update id="delete"
		parameterType="com.project.itda.timeline.model.TimeLineModel">
		update
		TIMELINE set VISIBLE = 'n'
		WHERE POSTSEQ = #{postSeq}
	</update>
	
	<select id="getReply"
		resultType="com.project.itda.timeline.model.TimeLineReplyModel">
		SELECT u.userName, r.replySeq, r.postSeq, r.replyDate, r.replyContent, r.userId
		FROM reply r JOIN itdauser u
		on r.userId = u.userId
		WHERE postSeq = #{postSeq}
		ORDER BY r.createDate DESC
	</select>
	
	<insert id="insertReply" parameterType="com.project.itda.timeline.model.TimeLineReplyModel">
		INSERT INTO TIMELINEREPLY (replySeq, postSeq, replyDate, replyContent, userId)
			VALUES (replySeq.NEXTVAL, #{postSeq}, SYSDATE, #{Content}, #{userId})
	</insert>
	
	<update id="updateReply"
		parameterType="com.project.itda.timeline.model.TimeLineReplyModel">
		<![CDATA[
		update TIMELINEREPLY set 
		    replyContent = #{replyContent, jdbcType=CLOB}
		    WHERE replySeq = #{replySeq}
		]]>
	</update>
	
	<delete id="deleteReply">
		delete from TIMELINEREPLY
		where replySeq = #{replySeq}
	</delete>
	
	<select id="countPostOneReply" parameterType="int" resultType="int">
		<![CDATA[
			SELECT COUNT(*)
			FROM TIMELINEREPLY
			WHERE postSeq = #{postSeq}
		]]>
	</select>
	
	
	
</mapper>